{% extends 'base.html' %}
{% block content %}
<div class="grid">
  <div class="card">
    <h2>选择时间</h2>
    <form class="row" method="get" action="/">
      <label>年份</label>
      <input style="max-width:120px" name="year" value="{{ year }}" />
      <label>月份</label>
      <input style="max-width:80px" name="month" value="{{ month }}" />
      <button class="btn" type="submit">查看</button>
    </form>
    <p class="muted" style="margin-top:8px">按月查看统计；点击用户名可查看个人明细。</p>
  </div>
  <div class="card">
    <div class="row"><div class="kpi">进行中活动</div><span class="pill">{{ events|length }} 个</span></div>
    <ul>
      {% for e in events %}
        <li>{{ e.name }}{% if e.is_reproduction %} · 复现{% endif %}{% if not e.is_active %} · 已停用{% endif %}</li>
      {% else %}
        <li class="muted">暂无活动</li>
      {% endfor %}
    </ul>
  </div>
  </div>

<div class="grid">
  <div class="card">
    <h3>主队积分榜</h3>
    <table>
      <thead><tr><th>#</th><th>队员</th><th>本月积分</th><th>累计积分</th></tr></thead>
      <tbody>
      {% for row in main_rows %}
        <tr>
          <td>{{ loop.index }}</td>
          <td><a href="/user/{{ row.user_id }}?year={{ year }}&month={{ month }}">{{ row.username }}</a></td>
          <td>{{ '%.2f' % row.month_points }}</td>
          <td>{{ '%.2f' % row.total_points }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">暂无数据</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="card">
    <h3>子队积分榜</h3>
    <table>
      <thead><tr><th>#</th><th>队员</th><th>本月积分</th><th>累计积分</th></tr></thead>
      <tbody>
      {% for row in sub_rows %}
        <tr>
          <td>{{ loop.index }}</td>
          <td><a href="/user/{{ row.user_id }}?year={{ year }}&month={{ month }}">{{ row.username }}</a></td>
          <td>{{ '%.2f' % row.month_points }}</td>
          <td>{{ '%.2f' % row.total_points }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">暂无数据</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
