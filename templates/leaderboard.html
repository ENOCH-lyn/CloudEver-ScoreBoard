{% extends 'base.html' %}
{% block content %}
<div class="grid">
  <div class="card" style="min-height:220px">
    <div class="row" style="justify-content:space-between; align-items:center">
      <div class="kpi">公告</div>
      <span class="pill">{{ announcements|length }} 条</span>
    </div>
    <ul style="max-height:160px; overflow:auto; margin-top:8px">
      {% for a in announcements %}
        <li>
          <a href="/announcement/{{ a.id }}" title="{{ a.title }}">{{ a.title }}</a>
        </li>
      {% else %}
        <li class="muted">暂无公告</li>
      {% endfor %}
    </ul>
  </div>
  <div class="card">
    <div class="row"><div class="kpi">进行中活动</div><span class="pill">{{ events|length }} 个</span></div>
    <ul>
      {% for e in events %}
        <li><a href="/submit/{{ e.id }}">{{ e.name }}</a>{% if e.is_reproduction %} · 复现{% endif %}{% if not e.is_active %} · 已停用{% endif %}</li>
      {% else %}
        <li class="muted">暂无活动</li>
      {% endfor %}
    </ul>
  </div>
  </div>

<div class="grid">
  <div class="card">
    <h3>主队积分榜</h3>
    <table class="table-cards">
      <thead><tr><th>#</th><th>队员</th><th>本月积分</th><th>累计积分</th></tr></thead>
      <tbody>
      {% for row in main_rows %}
        <tr>
          <td>{{ loop.index }}</td>
          <td><a href="/user/{{ row.user_id }}?year={{ year }}&month={{ month }}">{{ row.username }}</a></td>
          <td>{{ '%.2f' % row.month_points }}</td>
          <td>{{ '%.2f' % row.total_points }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">暂无数据</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="card">
    <h3>子队积分榜</h3>
    <table class="table-cards">
      <thead><tr><th>#</th><th>队员</th><th>本月积分</th><th>累计积分</th></tr></thead>
      <tbody>
      {% for row in sub_rows %}
        <tr>
          <td>{{ loop.index }}</td>
          <td><a href="/user/{{ row.user_id }}?year={{ year }}&month={{ month }}">{{ row.username }}</a></td>
          <td>{{ '%.2f' % row.month_points }}</td>
          <td>{{ '%.2f' % row.total_points }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">暂无数据</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
