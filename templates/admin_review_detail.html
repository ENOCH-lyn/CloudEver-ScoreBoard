{% extends 'base.html' %}
{% block content %}
<div class="card">
  <h2>审核 — 提交 #{{ sub.id }} · {{ user.username }} · {{ event.name }}</h2>
  <p class="muted">
    提交时间：{{ sub.created_at }}
    {% if sub.wp_url %}｜外链：<a href="{{ sub.wp_url }}" target="_blank">{{ sub.wp_url }}</a>{% endif %}
    {% if sub.wp_md %}｜<a href="/submission/{{ sub.id }}">查看 Markdown</a>{% endif %}
  </p>
  <form method="post" action="/admin/review/{{ sub.id }}/approve_all">
    <button class="btn" type="submit">一键通过所有待审题目</button>
  </form>
</div>

<div class="card">
  <h3>题目列表</h3>
  <table>
    <thead><tr><th>#</th><th>类别</th><th>题目</th><th>基础分</th><th>状态</th><th>操作</th></tr></thead>
    <tbody>
    {% for it in items %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ it.challenge.category }}</td>
        <td>{{ it.challenge.name }}</td>
        <td>{{ it.challenge.base_score }}</td>
        <td>
          {% if not it.approved %}<span class="status pending">待审</span>
          {% elif it.revoked %}<span class="status rev">已撤销</span>
          {% else %}<span class="status ok">已计分</span>{% endif %}
        </td>
        <td class="row">
          {% if not it.approved %}
            <form method="post" action="/admin/review/item/{{ it.id }}/toggle_approve">
              <button class="btn" type="submit">通过</button>
            </form>
          {% endif %}
          {% if it.approved %}
            <form method="post" action="/admin/review/item/{{ it.id }}/toggle_revoke">
              <button class="btn warn" type="submit">{{ '恢复分数' if it.revoked else '撤销分数' }}</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% else %}
      <tr><td colspan="6" class="muted">该提交暂无题目</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
