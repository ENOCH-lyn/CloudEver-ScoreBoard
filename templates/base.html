<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or 'CTF 战队考核系统' }}</title>
  <style>
    /* Light theme - Google-like, airy UI */
    :root{
      --bg:#f6f7fb;        /* page background */
      --surface:#ffffff;    /* cards/nav surfaces */
      --border:#e7e8ee;     /* hairline borders */
      --text:#1f2937;       /* primary text */
      --muted:#6b7280;      /* secondary text */
      --accent:#1a73e8;     /* Google blue */
      --accent-2:#185abc;   /* darker blue */
      --success:#16a34a;    /* status ok */
      --warn:#e11d48;       /* destructive */
      --shadow:0 1px 2px rgba(16,24,40,.06), 0 1px 3px rgba(16,24,40,.1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans SC', Arial;
      margin:0; color:var(--text); background:var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; gap:16px; padding:12px 20px;
      background:var(--surface);
      border-bottom:1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .brand{font-weight:800; letter-spacing:.3px}
    .brand b{color:var(--text)}
    .brand small{color:var(--muted); font-weight:600}
  .nav{display:flex; align-items:center}
  .nav a{margin-right:12px; color:#475569; text-decoration:none; font-weight:600; padding:8px 0}
  .nav a:hover{color:#111827; text-decoration:none}
  .nav a.active{color:#111827}

  .hamburger{display:none; width:40px; height:40px; align-items:center; justify-content:center; border:1px solid var(--border); border-radius:10px; background:#fff; cursor:pointer}
  .hamburger span{display:block; width:18px; height:2px; background:#334155; position:relative}
  .hamburger span::before, .hamburger span::after{content:""; position:absolute; left:0; width:18px; height:2px; background:#334155}
  .hamburger span::before{top:-6px}
  .hamburger span::after{top:6px}

  /* Full-width content container to allow cards to adapt fluidly */
  .wrap{width:100%; max-width:none; margin:0 auto; padding:24px 22px}

    .card{
      position:relative; margin:14px 0; padding:18px 18px;
      background:var(--surface);
      border:1px solid var(--border); border-radius:14px; box-shadow: var(--shadow);
    }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(420px,1fr)); gap:16px}
    .muted{color:var(--muted)}
    .kpi{font-weight:800; font-size:28px; letter-spacing:.5px}
    .pill{padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#f2f4f8}

    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px;
      background:var(--accent);
      color:#fff; font-weight:700; border:1px solid var(--accent-2); padding:10px 14px; border-radius:10px; cursor:pointer}
    .btn.secondary{background:#f1f5ff; color:#1e3a8a; border:1px solid #c7d2fe}
    .btn.warn{background:var(--warn); color:#fff; border-color:#be123c}

    input,select,textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; color:var(--text)
    }
    input:focus,select:focus,textarea:focus{outline:none; border-color:#93c5fd; box-shadow:0 0 0 3px rgba(147,197,253,.35)}
    /* Remove harsh blue ring for checkbox/radio focus while keeping accessibility */
    input[type=checkbox], input[type=radio]{ width:auto }
    input[type=checkbox]:focus, input[type=radio]:focus{ outline:none; box-shadow:none; }
  label{display:block; font-weight:700; font-size:13px; color:#334155; margin:6px 0 6px}

    input[type=file]{
      border:1px dashed #cbd5e1; padding:12px; background:#f8fafc; color:#334155
    }

    table{width:100%; border-collapse:separate; border-spacing:0; background:#fff}
    thead th{font-size:12px; text-transform:uppercase; letter-spacing:.06em; color:#6b7280}
  th,td{padding:10px 10px; border-bottom:1px solid var(--border); text-align:left; word-break:break-word}
    tbody tr:hover{background:#f9fafb}

    .status{font-size:12px; padding:2px 6px; border-radius:999px; border:1px solid var(--border)}
    .pending{background:#f1f5f9}
    .ok{background:#ecfdf5; border-color:#bbf7d0}
    .rev{background:#fef2f2; border-color:#fecaca}

  .md{background:#f8fafc; padding:12px; border-radius:12px; border:1px solid var(--border); overflow-x:auto; word-break:break-word; overflow-wrap:anywhere}
    .md pre{background:#f1f5f9; padding:10px; border-radius:8px}
    .md code{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace}

  /* Clean list UI for cards (announcements/events) */
  .list{list-style:none; padding:0; margin:8px 0 0}
  .list .list-item{margin:8px 0}
  .list .list-link{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#f8fafc; color:#334155; text-decoration:none}
  .list .list-link:hover{background:#f1f5ff; border-color:#c7d2fe; text-decoration:none}
  .list .title{font-weight:700; color:#111827}
  .list .meta{display:flex; gap:6px; align-items:center; white-space:nowrap}
  .line-clamp-1{display:-webkit-box; -webkit-line-clamp:1; line-clamp:1; -webkit-box-orient:vertical; overflow:hidden}
  /* Inline label helper (override block labels when needed) */
  .label-inline{display:inline-block; font-weight:700; font-size:13px; color:#334155; margin:0 6px 0 0}
  /* Toolbar for filters */
  .toolbar{display:flex; align-items:flex-end; gap:14px; padding:12px 14px; border:1px solid var(--border); border-radius:12px; background:var(--surface); box-shadow:var(--shadow); flex-wrap:wrap}
  .toolbar .divider{width:1px; height:28px; background:var(--border)}
  .toolbar .field{display:flex; flex-direction:column; gap:6px; min-width:200px}
  .toolbar .field.small{min-width:120px}
  .toolbar .caption{font-size:12px; color:var(--muted); font-weight:700}
  .toolbar .actions{margin-left:auto; display:flex; align-items:center; gap:10px}
  /* 控件高度统一，按钮与控件底部对齐，保证“平行” */
  .toolbar .field select,
  .toolbar .field input{height:40px}
  .toolbar .field .seg{height:40px; align-items:center}
  .toolbar .seg label{padding:9px 14px}
  /* 等分的分段控件（用于状态：三等分填满可用宽度） */
  .seg.equal{display:flex; width:100%}
  .seg.equal label{flex:1 1 0; text-align:center}
  /* 搜索框不需要太长，给出合理最大宽度 */
  .toolbar .field.grow{flex:1 1 320px; max-width:560px}
  .grow{flex:1 1 260px}
  /* Segmented control for filters */
  .seg{display:inline-flex; align-items:center; gap:2px; padding:2px; border:1px solid var(--border); border-radius:12px; background:#fff}
  .seg input{position:absolute; opacity:0; pointer-events:none}
  .seg label{padding:8px 14px; cursor:pointer; color:#334155; user-select:none; border-radius:10px; transition:background .15s, color .15s}
  .seg input:checked + label{background:var(--accent); color:#fff}
  /* Pretty scroll container for lists */
  .list-scroll{max-height:260px; overflow:auto; -webkit-overflow-scrolling:touch; scrollbar-gutter:stable}
  .list-scroll{scrollbar-width:thin; scrollbar-color:#cbd5e1 transparent}
  .list-scroll::-webkit-scrollbar{width:8px; height:8px}
  .list-scroll::-webkit-scrollbar-thumb{background:#cbd5e1; border-radius:8px}
  .list-scroll:hover::-webkit-scrollbar-thumb{background:#94a3b8}
  .list-scroll-lg{max-height:360px}

  .avatar{width:36px; height:36px; border-radius:999px; border:1px solid var(--border); object-fit:cover; vertical-align:middle}
  .avatar-initial{width:88px; height:88px; border-radius:999px; border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-weight:800; color:#1f2937; background:linear-gradient(135deg,#f1f5f9,#e2e8f0)}
    .user-menu{position:relative}
  .user-trigger{display:flex; align-items:center; gap:8px; padding:6px; border-radius:999px; cursor:pointer}
  .user-trigger:hover{background:transparent}
    .menu{position:absolute; right:0; top:46px; min-width:160px; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); display:none}
    .menu a, .menu form button{display:block; width:100%; text-align:left; padding:10px 12px; color:#334155; text-decoration:none; background:transparent; border:none; cursor:pointer}
    .menu a:hover, .menu form button:hover{background:#f1f5ff}
  /* Side nav for advanced admin */
  .side-nav{display:flex; flex-direction:column}
  .side-nav a{padding:12px 16px; border-bottom:1px solid var(--border); color:#334155; text-decoration:none}
  .side-nav a:hover{background:#f8fafc}

  /* Admin aside default width */
  .admin-aside{width:240px}

  /* Chips for multi-line tags */
  .chips{display:flex; flex-wrap:wrap; gap:6px}
  .chip{display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:#f8fafc; font-size:12px; color:#334155}

  /* Mobile styles */
  @media (max-width: 640px){
    header{padding:10px 12px}
    .wrap{padding:14px 12px}
    .card{padding:14px}
    .kpi{font-size:22px}
    .hamburger{display:inline-flex}
    header .nav{display:none; position:absolute; top:54px; left:0; right:0; background:var(--surface); border-bottom:1px solid var(--border); box-shadow: var(--shadow); flex-direction:column; padding:10px 12px}
    header .nav.open{display:flex}
    header .nav a{padding:10px 4px; margin:0}
  /* 仅对非卡片表格启用横向滚动容器，避免影响 .table-cards 的铺满效果 */
  table:not(.table-cards){display:block; width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; font-size:14px}
    thead th, td{white-space:normal; word-break:break-word}
    .row{gap:8px}
    .row{flex-wrap:wrap !important}
    .grid{grid-template-columns: 1fr}
    .admin-aside{width:100%}
    .side-nav{flex-direction:row; flex-wrap:wrap; gap:8px; padding:12px}
    .side-nav a{border:1px solid var(--border); border-radius:10px; background:#f8fafc; padding:8px 10px}
    /* Helpers */
    .hide-sm{display:none !important}
    /* Shorter list scroll box on small screens */
    .list-scroll{max-height:200px}
    .list-scroll-lg{max-height:300px}
    .toolbar{gap:10px; box-shadow:none; align-items:stretch}
    .toolbar .divider{display:none}
    .toolbar .field{min-width:140px; flex:1 1 100%}
    .toolbar .actions{width:100%}
    .toolbar .actions .btn{width:100%}
    /* Utility: full width on small screens */
    .full-sm{width:100%}
  }
  /* Card-style tables on mobile */
  @media (max-width: 640px){
    table.table-cards{border-collapse:separate; border-spacing:0; width:100%;}
    table.table-cards thead{display:none}
    table.table-cards tr{display:block; background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px; margin:10px 0}
    table.table-cards td{display:flex; align-items:flex-start; justify-content:space-between; gap:8px; padding:6px 4px; border:none}
    table.table-cards td::before{content:attr(data-label); color:var(--muted); font-weight:600; margin-right:12px; min-width:92px}
  }
  </style>
</head>
<body>
  <header>
    <div class="brand">CloudEver <small>ScoreBoard</small></div>
  <button class="hamburger" id="mobileMenuBtn" aria-label="打开菜单"><span></span></button>
  <div class="nav" id="mainNav">
  <a href="/">积分榜</a>
      <a href="/rules">战队规则</a>
      <a href="/submit">提交成绩</a>
      {% if current_user and (current_user.role == 'admin' or current_user.role == 'reviewer') %}
        <a href="/admin/review">审核</a>
        <a href="/admin/events">活动</a>
      {% endif %}
      {% if current_user and (current_user.role == 'admin' or current_user.role == 'reviewer') %}
        <a href="/admin/users">成员</a>
      {% endif %}
    </div>
    <div style="margin-left:auto">
      {% if current_user %}
        <div class="user-menu" id="userMenu">
          <div class="user-trigger" id="userTrigger">
            {% if avatar_url %}<img class="avatar" src="{{ avatar_url }}" alt="avatar" />{% endif %}
            <span class="muted" style="font-weight:600">{{ current_user.username }}</span>
          </div>
          <div class="menu" id="userDropdown">
            <div style="padding:8px 12px; color:#6b7280; font-size:12px;">{{ '主队' if current_user.team_type=='main' else '子队' }}</div>
            {% if current_user.role == 'admin' %}
              <a href="/admin/advanced">管理员面板</a>
            {% endif %}
            <a href="/profile">个人设置</a>
            <form action="/auth/logout" method="post"><button type="submit">退出登录</button></form>
          </div>
        </div>
      {% else %}
        <a class="btn secondary" href="/auth/login">登录</a>
        <a class="btn" style="margin-left:8px" href="/auth/register">注册</a>
      {% endif %}
    </div>
  </header>
  <div class="wrap">
    {% if msg %}<div class="card">{{ msg }}</div>{% endif %}
    {% block content %}{% endblock %}
  </div>
  <script>
    // 高亮当前所在页面的导航项（而不是按使用次数加深颜色）
    const navLinks = document.querySelectorAll('header .nav a');
    navLinks.forEach(a => {
      const href = a.getAttribute('href') || '';
      const path = window.location.pathname;
      if (href === path || (href !== '/' && path.startsWith(href))) {
        a.classList.add('active');
      }
    });
    // Mobile nav toggle
    const mobileBtn = document.getElementById('mobileMenuBtn');
    const mainNav = document.getElementById('mainNav');
    if (mobileBtn && mainNav){
      mobileBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        mainNav.classList.toggle('open');
      });
      document.addEventListener('click', ()=>{ mainNav.classList.remove('open'); });
    }
    // Avatar dropdown
    const trigger = document.getElementById('userTrigger');
    const dropdown = document.getElementById('userDropdown');
    if (trigger && dropdown){
      trigger.addEventListener('click', (e)=>{
        e.stopPropagation();
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      });
      document.addEventListener('click', ()=>{ dropdown.style.display='none'; });
    }

    // Auto add data-labels for card tables (mobile)
    const enhanceCardTables = ()=>{
      document.querySelectorAll('table.table-cards').forEach(tbl => {
        const headers = Array.from(tbl.querySelectorAll('thead th')).map(th => th.textContent.trim());
        tbl.querySelectorAll('tbody tr').forEach(tr => {
          Array.from(tr.children).forEach((td, i) => {
            if (!td.getAttribute('data-label') && headers[i]){
              td.setAttribute('data-label', headers[i]);
            }
          });
        });
      });
    };
    enhanceCardTables();
  </script>
</body>
</html>
