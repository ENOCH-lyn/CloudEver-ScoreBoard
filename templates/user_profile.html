{% extends 'base.html' %}
{% block content %}
<div class="card">
  <div class="row" style="align-items:center; gap:16px; flex-wrap:nowrap">
    {% if user.avatar_filename %}
      <img class="avatar" style="width:88px;height:88px" src="/images/{{ user.avatar_filename }}" alt="avatar" />
    {% else %}
      <div class="avatar-initial">{{ user.username[:1] }}</div>
    {% endif %}
    <div style="min-width:0">
      <h2 style="margin:0; display:flex; align-items:center; gap:10px">
        <span style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap">{{ user.username }}</span>
        <span class="pill">{{ '主队' if user.team_type=='main' else '子队' }}</span>
      </h2>
      <p class="muted" style="margin:6px 0 0">{{ year }} 年 {{ month }} 月 — 本月积分：<b>{{ '%.2f' % month_points }}</b>；累计积分：<b>{{ '%.2f' % total_points }}</b></p>
    </div>
  </div>
</div>

<div class="card">
  <h3>本月提交明细</h3>
  <table class="table-cards">
    <thead><tr><th>时间</th><th>活动</th><th>积分</th><th>已通过</th><th>待审</th><th>被撤销</th><th>题目</th></tr></thead>
    <tbody>
    {% for row in details %}
      <tr>
        <td>{{ row.created_at }}</td>
        <td>{{ row.event_name }}</td>
        <td>{{ '%.2f' % row.points }}</td>
        <td>{{ row.count_ok }}</td>
        <td>{{ row.count_pending }}</td>
        <td>{{ row.count_revoked }}</td>
        <td>
          {% if row.challenges and row.challenges|length > 0 %}
            <div class="chips">
              {% for n in row.challenges %}
                <span class="chip">{{ n }}</span>
              {% endfor %}
            </div>
          {% else %}
            <span class="muted">—</span>
          {% endif %}
        </td>
      </tr>
    {% else %}
      <tr><td colspan="7" class="muted">本月暂无提交</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
