{% extends 'base.html' %}
{% block content %}
<div class="card">
  <h2>提交成绩 — {{ event.name }}</h2>
  <form method="post">
    <div class="row" style="justify-content:space-between; align-items:center">
      <label>已解题目</label>
      <div class="row">
        <button class="btn secondary" type="button" id="btnCheckAll">全选</button>
        <button class="btn secondary" type="button" id="btnClearAll">清空选择</button>
      </div>
    </div>

    {% if challenges %}
      <table>
  <thead><tr><th style="width:56px">选择</th><th class="hide-sm">类别</th><th>题目</th><th style="width:120px">基础分</th></tr></thead>
        <tbody>
        {% for ch in challenges %}
          {% set cbid = 'chk_' ~ ch.id %}
          <tr class="ch-row" data-target="{{ cbid }}" style="cursor:pointer">
            <td>
              <input id="{{ cbid }}" type="checkbox" name="ch_{{ ch.id }}" />
            </td>
            <td class="hide-sm"><span class="pill">{{ ch.category }}</span></td>
            <td>{{ ch.name }}</td>
            <td>{{ ch.base_score }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">该活动尚未配置题目</p>
    {% endif %}

    <label style="margin-top:12px">WP 链接（可选）</label>
    <input name="wp_url" placeholder="https://..." />

    <label style="margin-top:12px">WP Markdown（可选）</label>
    <textarea name="wp_md" rows="8" placeholder="# 我的解题报告
..."></textarea>

    <div style="margin-top:12px"><button class="btn" type="submit">提交</button></div>
  </form>
</div>
<script>
  const btnAll = document.getElementById('btnCheckAll');
  const btnClear = document.getElementById('btnClearAll');
  const toggle = (val)=>{
    document.querySelectorAll('input[type=checkbox][name^="ch_"]').forEach(cb=>{ cb.checked = val; });
  };
  if (btnAll) btnAll.addEventListener('click', ()=> toggle(true));
  if (btnClear) btnClear.addEventListener('click', ()=> toggle(false));
  // Row click toggles checkbox
  document.querySelectorAll('tr.ch-row').forEach(tr=>{
    tr.addEventListener('click', (e)=>{
      // ignore direct clicks on input to avoid double toggle
      if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'LABEL')) return;
      const id = tr.getAttribute('data-target');
      const cb = id && document.getElementById(id);
      if (cb){ cb.checked = !cb.checked; }
    });
  });
</script>
{% endblock %}
