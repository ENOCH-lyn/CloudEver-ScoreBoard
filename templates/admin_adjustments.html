{% extends 'base.html' %}
{% block content %}
<div class="row" style="align-items:flex-start">
  {% include 'partials/admin_side_nav.html' %}
  <main style="flex:1">
  <div class="card">
    <h2>积分调整（仅影响指定月份）</h2>
  <form class="row" method="get" action="/admin/adjustments">
      <label>年份</label>
      <input style="max-width:120px" name="year" value="{{ year }}" />
      <label>月份</label>
  <input style="max-width:120px" name="month" value="{{ month }}" />
      <button class="btn" type="submit">查看</button>
    </form>
  <table class="table-cards">
  <thead><tr><th>成员</th><th>分值</th><th>原因</th><th>创建时间</th><th>操作</th></tr></thead>
      <tbody>
      {% for a in adjs %}
        <tr>
          <td>{{ (user_map.get(a.user_id) or '—') }}</td>
          <td>{{ '%.2f' % a.amount }}</td>
          <td>{{ a.reason }}</td>
          <td>{{ a.created_at }}</td>
          <td>
            <form method="post" action="/admin/adjustments/{{ a.id }}/delete" onsubmit="return confirm('移入垃圾箱？');">
              <button class="btn warn" type="submit">删除</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="muted">暂无调整</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>新增调整</h3>
    <form method="post" action="/admin/adjustments/create">
      <div class="row">
        <label>成员</label>
        <select name="user_id" style="max-width:220px">
          {% for u in users %}
            <option value="{{ u.id }}">{{ u.username }}</option>
          {% endfor %}
        </select>
        <label>年份</label>
        <input name="year" value="{{ year }}" style="max-width:120px" />
        <label>月份</label>
        <input name="month" value="{{ month }}" style="max-width:120px" />
      </div>
      <label>分值（可为负）</label>
      <input name="amount" value="0" />
      <label>原因</label>
      <textarea name="reason" rows="3" placeholder="例如：补记、惩罚、奖励等"></textarea>
      <div style="margin-top:12px"><button class="btn" type="submit">添加</button></div>
    </form>
  </div>
  </main>
</div>
{% endblock %}
