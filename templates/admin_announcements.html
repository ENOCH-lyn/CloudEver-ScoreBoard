{% extends 'base.html' %}
{% block content %}
<div class="row" style="align-items:flex-start">
  {% include 'partials/admin_side_nav.html' %}
  <main style="flex:1">
  <div class="card">
    <h2>公告管理</h2>
    <p class="muted">管理员可新建、编辑、隐藏或删除公告（删除进入垃圾箱）。</p>
  <table class="table-cards">
      <thead><tr><th>标题</th><th>可见</th><th>更新时间</th><th>操作</th></tr></thead>
      <tbody>
      {% for a in anns %}
        <tr>
          <td>{{ a.title }}</td>
          <td>{{ '是' if a.visible else '否' }}</td>
          <td>{{ a.updated_at }}</td>
          <td class="row">
            <details>
              <summary class="btn secondary">编辑</summary>
              <form method="post" action="/admin/announcements/{{ a.id }}/update" style="margin-top:8px">
                <label>标题</label>
                <input name="title" value="{{ a.title }}" required />
                <label>内容（Markdown）</label>
                <textarea name="content" rows="6">{{ a.content }}</textarea>
                <label>可见</label>
                <select name="visible"><option value="1" {% if a.visible %}selected{% endif %}>是</option><option value="0" {% if not a.visible %}selected{% endif %}>否</option></select>
                <div style="margin-top:8px"><button class="btn" type="submit">保存</button></div>
              </form>
            </details>
            <form id="ann_toggle_{{ a.id }}" method="post" action="/admin/announcements/{{ a.id }}/toggle" style="display:none"></form>
            <a class="btn secondary" href="#" onclick="document.getElementById('ann_toggle_{{ a.id }}').submit(); return false;">{{ '隐藏' if a.visible else '显示' }}</a>
            <form method="post" action="/admin/announcements/{{ a.id }}/delete" style="display:inline" onsubmit="return confirm('移入垃圾箱？');">
              <button class="btn warn" type="submit">删除</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="4" class="muted">暂无公告</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>新建公告</h3>
    <form method="post" action="/admin/announcements/create">
      <label>标题</label>
      <input name="title" required />
      <label>内容（Markdown）</label>
      <textarea name="content" rows="8"></textarea>
      <label>可见</label>
      <select name="visible"><option value="1">是</option><option value="0">否</option></select>
      <div style="margin-top:12px"><button class="btn" type="submit">发布</button></div>
    </form>
  </div>
  </main>
</div>
{% endblock %}
